/**
 * JustGage - a handy JavaScript plugin for generating and animating nice & clean dashboard gauges.
 * Copyright (c) 2012 Bojan Djuricic - pindjur(at)gmail(dot)com | http://www.madcog.com
 * Licensed under MIT.
 * Date: 31/07/2012
 * @author Bojan Djuricic  (@Toorshia)
 * @version 1.0
 *
 * http://www.justgage.com
 */
 
JustGage=function(i){if(!i.id){alert("Missing id parameter for gauge!");return false}if(!document.getElementById(i.id)){alert("No element with id: \""+i.id+"\" found!");return false}this.config={id:i.id,title:(i.title)?i.title:"",fixedProgress:(i.fixedProgress!=null)?i.fixedProgress:false,progressValues:(i.progressValues)?i.progressValues:null,titleFontColor:(i.titleFontColor)?i.titleFontColor:"#999999",value:(i.value)?i.value:0,valueText:(i.valueText)?i.valueText:((i.value)?i.value:0),valueFontColor:(i.valueFontColor)?i.valueFontColor:"#010101",min:(i.min)?i.min:0,max:(i.max)?i.max:100,showMinMax:(i.showMinMax!=null)?i.showMinMax:true,gaugeWidthScale:(i.gaugeWidthScale)?i.gaugeWidthScale:1.0,gaugeColor:(i.gaugeColor)?i.gaugeColor:"#edebeb",label:(i.label)?i.label:"",showInnerShadow:(i.showInnerShadow!=null)?i.showInnerShadow:true,shadowOpacity:(i.shadowOpacity)?i.shadowOpacity:0.2,shadowSize:(i.shadowSize)?i.shadowSize:5,shadowVerticalOffset:(i.shadowVerticalOffset)?i.shadowVerticalOffset:3,levelColors:(i.levelColors)?i.levelColors:percentColors,levelColorsGradient:(i.levelColorsGradient!=null)?i.levelColorsGradient:true,labelFontColor:(i.labelFontColor)?i.labelFontColor:"#b3b3b3",startAnimationTime:(i.startAnimationTime)?i.startAnimationTime:700,startAnimationType:(i.startAnimationType)?i.startAnimationType:">",refreshAnimationTime:(i.refreshAnimationTime)?i.refreshAnimationTime:700,refreshAnimationType:(i.refreshAnimationType)?i.refreshAnimationType:">"};if(i.value>this.config.max)this.config.value=this.config.max;if(i.value<this.config.min)this.config.value=this.config.min;this.originalValue=i.value;this.canvas=Raphael(this.config.id,"100%","100%");var j=getStyle(document.getElementById(this.config.id),"width").slice(0,-2)*1;var k=getStyle(document.getElementById(this.config.id),"height").slice(0,-2)*1;var l,widgetH;if((j/k)>1.25){l=1.25*k;widgetH=k}else{l=j;widgetH=j/1.25}var m=(j-l)/2;var n=(k-widgetH)/2;var o=((widgetH/8)>10)?(widgetH/10):10;var p=m+l/2;var q=n+widgetH/6.5;var r=((widgetH/6.4)>16)?(widgetH/6.4):16;var s=m+l/2;var t=n+widgetH/1.4;var u=((widgetH/16)>10)?(widgetH/16):10;var v=m+l/2;var x=t+r/2+6;var y=((widgetH/16)>10)?(widgetH/16):10;var z=m+(l/10)+(l/6.666666666666667*this.config.gaugeWidthScale)/2;var A=n+widgetH/1.126760563380282;var B=((widgetH/16)>10)?(widgetH/16):10;var C=m+l-(l/10)-(l/6.666666666666667*this.config.gaugeWidthScale)/2;var D=n+widgetH/1.126760563380282;this.params={canvasW:j,canvasH:k,widgetW:l,widgetH:widgetH,dx:m,dy:n,titleFontSize:o,titleX:p,titleY:q,valueFontSize:r,valueX:s,valueY:t,labelFontSize:u,labelX:v,labelY:x,minFontSize:y,minX:z,minY:A,maxFontSize:B,maxX:C,maxY:D};this.canvas.customAttributes.pki=function(a,b,c,w,h,d,e,f){var g=(1-(a-b)/(c-b))*Math.PI,Ro=w/2-w/10,Ri=Ro-w/6.666666666666667*f,Cx=w/2+d,Cy=h/1.25+e,Xo=w/2+d+Ro*Math.cos(g),Yo=h-(h-Cy)+e-Ro*Math.sin(g),Xi=w/2+d+Ri*Math.cos(g),Yi=h-(h-Cy)+e-Ri*Math.sin(g),path;path+="M"+(Cx-Ri)+","+Cy+" ";path+="L"+(Cx-Ro)+","+Cy+" ";path+="A"+Ro+","+Ro+" 0 0,1 "+Xo+","+Yo+" ";path+="L"+Xi+","+Yi+" ";path+="A"+Ri+","+Ri+" 0 0,0 "+(Cx-Ri)+","+Cy+" ";path+="z ";return{path:path}}this.gauge=this.canvas.path().attr({"stroke":"none","fill":this.config.gaugeColor,pki:[this.config.max,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]});this.gauge.id=this.config.id+"-gauge";this.level=this.canvas.path().attr({"stroke":"none","fill":getColorForPercentage((this.config.value-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient,this.config.fixedProgress,this.config.progressValues),pki:[this.config.min,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]});this.level.id=this.config.id+"-level";this.txtTitle=this.canvas.text(this.params.titleX,this.params.titleY,this.config.title);this.txtTitle.attr({"font-size":this.params.titleFontSize,"font-weight":"bold","font-family":"Arial","fill":this.config.titleFontColor,"fill-opacity":"1"});this.txtTitle.id=this.config.id+"-txttitle";this.txtValue=this.canvas.text(this.params.valueX,this.params.valueY,this.config.valueText);this.txtValue.attr({"font-size":this.params.valueFontSize,"font-weight":"bold","font-family":"Arial","fill":this.config.valueFontColor,"fill-opacity":"0"});this.txtValue.id=this.config.id+"-txtvalue";this.txtLabel=this.canvas.text(this.params.labelX,this.params.labelY,this.config.label);this.txtLabel.attr({"font-size":this.params.labelFontSize,"font-weight":"normal","font-family":"Arial","fill":this.config.labelFontColor,"fill-opacity":"0"});this.txtLabel.id=this.config.id+"-txtlabel";this.txtMin=this.canvas.text(this.params.minX,this.params.minY,this.config.min);this.txtMin.attr({"font-size":this.params.minFontSize,"font-weight":"normal","font-family":"Arial","fill":this.config.labelFontColor,"fill-opacity":(this.config.showMinMax==true)?"1":"0"});this.txtMin.id=this.config.id+"-txtmin";this.txtMax=this.canvas.text(this.params.maxX,this.params.maxY,this.config.max);this.txtMax.attr({"font-size":this.params.maxFontSize,"font-weight":"normal","font-family":"Arial","fill":this.config.labelFontColor,"fill-opacity":(this.config.showMinMax==true)?"1":"0"});this.txtMax.id=this.config.id+"-txtmax";var E=this.canvas.canvas.childNodes[1];var F="http://www.w3.org/2000/svg";if(ie<9){onCreateElementNsReady(function(){this.generateShadow()})}else{this.generateShadow(F,E)}this.level.animate({pki:[this.config.value,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale]},this.config.startAnimationTime,this.config.startAnimationType);this.txtValue.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType);this.txtLabel.animate({"fill-opacity":"1"},this.config.startAnimationTime,this.config.startAnimationType)};JustGage.prototype.refresh=function(a){originalVal=a;if(a>this.config.max){a=this.config.max}if(a<this.config.min){a=this.config.min}var b=getColorForPercentage((a-this.config.min)/(this.config.max-this.config.min),this.config.levelColors,this.config.levelColorsGradient,this.config.fixedProgress,this.config.progressValues);this.canvas.getById(this.config.id+"-txtvalue").attr({"text":originalVal});this.canvas.getById(this.config.id+"-level").animate({pki:[a,this.config.min,this.config.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.config.gaugeWidthScale],"fill":b},this.config.refreshAnimationTime,this.config.refreshAnimationType)};var percentColors=["#a9d70b","#f9c802","#ff0000"]JustGage.prototype.generateShadow=function(a,b){var c=document.createElementNS(a,"filter");c.setAttribute("id",this.config.id+"-inner-shadow");b.appendChild(c);var d=document.createElementNS(a,"feOffset");d.setAttribute("dx",0);d.setAttribute("dy",this.config.shadowVerticalOffset);c.appendChild(d);var e=document.createElementNS(a,"feGaussianBlur");e.setAttribute("result","offset-blur");e.setAttribute("stdDeviation",this.config.shadowSize);c.appendChild(e);var f=document.createElementNS(a,"feComposite");f.setAttribute("operator","out");f.setAttribute("in","SourceGraphic");f.setAttribute("in2","offset-blur");f.setAttribute("result","inverse");c.appendChild(f);var g=document.createElementNS(a,"feFlood");g.setAttribute("flood-color","black");g.setAttribute("flood-opacity",this.config.shadowOpacity);g.setAttribute("result","color");c.appendChild(g);var h=document.createElementNS(a,"feComposite");h.setAttribute("operator","in");h.setAttribute("in","color");h.setAttribute("in2","inverse");h.setAttribute("result","shadow");c.appendChild(h);var i=document.createElementNS(a,"feComposite");i.setAttribute("operator","over");i.setAttribute("in","shadow");i.setAttribute("in2","SourceGraphic");c.appendChild(i);if(this.config.showInnerShadow==true){this.canvas.canvas.childNodes[2].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)");this.canvas.canvas.childNodes[3].setAttribute("filter","url(#"+this.config.id+"-inner-shadow)")}}var getColorForPercentage=function(a,b,c,d,e){var f=b.length;if(f===1)return b[0];var g=(c)?(1/(f-1)):(1/f);var h=new Array();for(var i=0;i<b.length;i++){var j=(d)?(e[i]):((c)?(g*i):(g*(i+1)));var k=parseInt((cutHex(b[i])).substring(0,2),16);var l=parseInt((cutHex(b[i])).substring(2,4),16);var m=parseInt((cutHex(b[i])).substring(4,6),16);h[i]={pct:j,color:{r:k,g:l,b:m}}}if(a==0)return'rgb('+[h[0].color.r,h[0].color.g,h[0].color.b].join(',')+')';for(var i=0;i<h.length;i++){if(a<=h[i].pct){if(c==true){var n=h[i-1];var o=h[i];var p=o.pct-n.pct;var q=(a-n.pct)/p;var r=1-q;var s=q;var t={r:Math.floor(n.color.r*r+o.color.r*s),g:Math.floor(n.color.g*r+o.color.g*s),b:Math.floor(n.color.b*r+o.color.b*s)};return'rgb('+[t.r,t.g,t.b].join(',')+')'}else{return'rgb('+[h[i].color.r,h[i].color.g,h[i].color.b].join(',')+')'}}}}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}function cutHex(a){return(a.charAt(0)=="#")?a.substring(1,7):a}function getStyle(c,d){var e="";if(document.defaultView&&document.defaultView.getComputedStyle){e=document.defaultView.getComputedStyle(c,"").getPropertyValue(d)}else if(c.currentStyle){d=d.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()});e=c.currentStyle[d]}return e}function onCreateElementNsReady(a){if(document.createElementNS!=undefined){a()}else{setTimeout(function(){onCreateElementNsReady(a)},100)}}var ie=(function(){var a,v=3,div=document.createElement('div'),all=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->',all[0]);return v>4?v:a}());